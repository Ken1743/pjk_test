# PJM System

React (applicant/admin) + Flask (backend) ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚  
Docker + docker-compose ã§ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚’çµ±ä¸€ã—ã€  
æœ¬ç•ªã¯ **Cloud Run (backend)** + **Firebase Hosting (frontend)** ã§é‹ç”¨ã—ã¾ã™ã€‚

---

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

pjm-system/
â”œâ”€â”€ README.md
â”œâ”€â”€ backend/ # Flask API
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ app.py
â”‚ â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/
â”‚ â”œâ”€â”€ applicant/ # React (æ±‚è·è€…å‘ã‘)
â”‚ â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”‚ â”œâ”€â”€ package.json
â”‚ â”‚ â”œâ”€â”€ src/App.js
â”‚ â”‚ â””â”€â”€ ...
â”‚ â””â”€â”€ admin/ # React (ç®¡ç†è€…å‘ã‘)
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ package.json
â”‚ â”œâ”€â”€ src/App.js
â”‚ â””â”€â”€ ...
â”œâ”€â”€ infra/
â”‚ â”œâ”€â”€ docker-compose.yml
â”‚ â””â”€â”€ .env.example
â””â”€â”€ .gitignore

yaml
---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ clone
```bash
git clone https://github.com/xxx/pjm-system.git
cd pjm-system
2. ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„
.env ã¯ GitHub ã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ä½œæˆã—ã¦ãã ã•ã„ï¼š

bash
cp infra/.env.example infra/.env
infra/.env.example ã®ä¾‹:

env
REACT_APP_API_URL=http://backend:8080
FLASK_ENV=development
SECRET_KEY=change_me

3. Docker ç’°å¢ƒã‚’èµ·å‹•
bash
cd infra
docker compose up --build
ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ï¼š
Backend (Flask API) â†’ http://localhost:8080/api/hello
Applicant Frontend â†’ http://localhost:3000
Admin Frontend â†’ http://localhost:3001

4. Backend å˜ä½“ã§ã®èµ·å‹•ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
bash
cd backend
pip install -r requirements.txt
flask run --host=0.0.0.0 --port=8080

5. Frontend å˜ä½“ã§ã®èµ·å‹•ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
applicant
bash
cd frontend/applicant
npm install
npm start
â†’ http://localhost:3000

admin
bash
cd frontend/admin
npm install
npm start
â†’ http://localhost:3001

âœ… å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
http://localhost:8080/api/hello ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ï¼š

json
{"message": "Hello from Flask API!"}
Applicant/Admin ã®ç”»é¢ã«

csharp
Backend says: Hello from Flask API!
ã¨è¡¨ç¤ºã•ã‚Œã‚‹

ğŸ›‘ .gitignore ãƒã‚¤ãƒ³ãƒˆ
node_modules/ ã¯ Git ã«å«ã‚ã¾ã›ã‚“

å„ãƒ¡ãƒ³ãƒãƒ¼ã¯ npm install ã§å†ç”Ÿæˆã—ã¦ãã ã•ã„
cd frontend/applicant
npm install

.env ã¯ Git ã«å«ã‚ã¾ã›ã‚“

ä»£ã‚ã‚Šã« .env.example ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã€å„è‡ªã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨

ğŸ“¦ ä»Šå¾Œã®é‹ç”¨
é–‹ç™º: docker compose up ã§çµ±ä¸€ç’°å¢ƒ

æœ¬ç•ª:

Backend â†’ Cloud Run (Docker image)

Frontend â†’ Firebase Hosting (ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†ã‘: applicant/admin)

CI/CD: GitHub Actions ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤äºˆå®š


ç¢ºèªæ–¹æ³•

1. Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ã‹
bash
cd infra
docker compose build


2. ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã§ãã‚‹ã‹
docker compose up
ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã“ã¨

backend-1, applicant-1, admin-1 ãŒç«‹ã¡ä¸ŠãŒã£ã¦ã„ã‚‹ã“ã¨

3. Backend API ã®å‹•ä½œç¢ºèª
ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯ curl ã§ç¢ºèªï¼š
curl http://localhost:8080/api/hello
æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š
{"message":"Hello from Flask API!"}

4. Applicant Frontend ã®ç¢ºèª
http://localhost:3000
 ã«ã‚¢ã‚¯ã‚»ã‚¹
è¡¨ç¤ºå†…å®¹ï¼š
Applicant Frontend
Backend says: Hello from Flask API!

######################################################################
######################################################################
######################################################################


æœ¬ç•ªæ§‹æˆã®å…¨ä½“åƒ

Backend (Flask)

ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆï¼šCloud Run

ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ï¼šDocker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ Artifact Registry ã« push â†’ Cloud Run ã« deploy

Frontend (applicant / admin, React)

ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆï¼šFirebase Hosting

ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ï¼šnpm run build ã§é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ â†’ Firebase CLI ã§ deploy

ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ†ã‘ã‚‹ã®ãŒç†æƒ³ä¾‹

applicant â†’ https://applicant.example.com

admin â†’ https://admin.example.com

ğŸ Backend (Flask â†’ Cloud Run)
1. GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæº–å‚™
gcloud auth login
gcloud config set project <YOUR_PROJECT_ID>
gcloud services enable run.googleapis.com artifactregistry.googleapis.com cloudbuild.googleapis.com

#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèªãƒ»åˆ‡ã‚Šæ›¿ãˆ
gcloud config list
gcloud config set project ringed-trail-472801-j4
gcloud config set compute/region asia-northeast1
gcloud config set compute/zone asia-northeast1-b

2. Artifact Registry ã‚’ä½œæˆ
gcloud artifacts repositories create <NAME>-repo \
  --repository-format=docker \
  --location=asia-northeast1 \
  --description="<NAME> container images"

3. Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ & push
cd backend
gcloud builds submit --tag asia-northeast1-docker.pkg.dev/<YOUR_PROJECT_ID>/<NAME>/<NAME>-backend:latest .

4. Cloud Run ã«ãƒ‡ãƒ—ãƒ­ã‚¤
gcloud run deploy pjm-backend \
  --image asia-northeast1-docker.pkg.dev/<YOUR_PROJECT_ID>/<Name>-repo/<Name>-backend:latest \
  --platform managed \
  --region asia-northeast1 \
  --allow-unauthenticated


ğŸ‘‰ æˆåŠŸã™ã‚‹ã¨ https://pjm-backend-xxxxx-asia-northeast1.run.app ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã‚’ React å´ã® .env.production ã«æ›¸ãã¾ã™ã€‚
React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨æ¥ç¶š
frontend/applicant/.env.production
frontend/admin/.env.production
ã«ä»¥ä¸‹ã‚’è¨˜å…¥ï¼š
REACT_APP_API_URL=https://pjm-backend-xxxxx-asia-northeast1.run.app


Firebase Hosting ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
1. Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

Firebase Console
 â†’ ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã€

åå‰ä¾‹: pjk-frontend

Google Analytics ã¯ä»»æ„

ğŸ‘‰ ä½œæˆã™ã‚‹ã¨ GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ç´ã¥ãã¾ã™ï¼ˆä¾‹: pjk-test-fcc32ï¼‰

2. Firebase CLI ã®æº–å‚™
npm install -g firebase-tools
firebase login
firebase projects:list   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª
firebase use <PROJECT_ID>   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ‡ã‚Šæ›¿ãˆ

3. Firebase Hosting ã‚µã‚¤ãƒˆã‚’ä½œæˆ

Hosting ã®ã‚µã‚¤ãƒˆ ID ã¯ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ä¸€æ„ ãŒå¿…è¦ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ï¼š

firebase hosting:sites:create pjk-applicant
firebase hosting:sites:create pjk-admin


ğŸ‘‰ ã“ã‚Œã§ applicant/admin ç”¨ã®2ã¤ã® Hosting ã‚µã‚¤ãƒˆãŒä½œæˆã•ã‚Œã‚‹

4. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å‰²ã‚Šå½“ã¦

ä½œæˆã—ãŸã‚µã‚¤ãƒˆã¨ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚’ç´ä»˜ã‘ã‚‹ï¼š

firebase target:clear hosting applicant   # å¿µã®ãŸã‚ãƒªã‚»ãƒƒãƒˆ
firebase target:apply hosting applicant pjk-applicant
firebase target:apply hosting admin pjk-admin

5. firebase.json ã‚’ç·¨é›†

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä»¥ä¸‹ã‚’é…ç½®ï¼š

{
  "hosting": [
    {
      "target": "applicant",
      "public": "frontend/applicant/build",
      "ignore": ["firebase.json", "**/.*", "**/node_modules/**"]
    },
    {
      "target": "admin",
      "public": "frontend/admin/build",
      "ignore": ["firebase.json", "**/.*", "**/node_modules/**"]
    }
  ]
}

6. React ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰
cd frontend/applicant
npm run build

cd ../admin
npm run build


ğŸ‘‰ build/ ãƒ•ã‚©ãƒ«ãƒ€ãŒç”Ÿæˆã•ã‚Œã‚‹

7. ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only hosting:applicant
firebase deploy --only hosting:admin

8. ç¢ºèª

applicant â†’ https://pjk-applicant.web.app

admin â†’ https://pjk-admin.web.app

ä¸¡æ–¹ã§

Backend says: Hello from Flask API!


ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸ ğŸ‰

9. Backend æ¥ç¶šè¨­å®š

frontend/applicant/.env.production
frontend/admin/.env.production

REACT_APP_API_URL=https://backend-xxxx.asia-northeast1.run.app


ğŸ‘‰ ã“ã‚Œã§æœ¬ç•ªç’°å¢ƒã® React ã‹ã‚‰ Cloud Run API ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹

âœ… ã¾ã¨ã‚

Cloud Run = Flask backend

Firebase Hosting = applicant/admin React frontend

ä¸¡è€…ã‚’ .env.production çµŒç”±ã§æ¥ç¶š

æœ€çµ‚çš„ã« applicant/admin ã‚µã‚¤ãƒˆã‹ã‚‰ backend API ã‚’å©ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹




ğŸ“„ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸
ğŸš€ æ§‹æˆæ¦‚è¦

Backend (Flask API) â†’ Google Cloud Run

Frontend (React applicant/admin) â†’ Firebase Hosting

æ¥ç¶š â†’ React ç’°å¢ƒå¤‰æ•° (REACT_APP_API_URL) ã§ Cloud Run ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®š

1. GCP (Backend: Flask â†’ Cloud Run)
1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
gcloud config set project ringed-trail-472801-j4
gcloud config set compute/region asia-northeast1
gcloud config set compute/zone asia-northeast1-b

1.2 Artifact Registry ã®ä½œæˆ
gcloud artifacts repositories create backend-repo \
  --repository-format=docker \
  --location=asia-northeast1 \
  --description="Backend container images"

1.3 Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ & push
cd backend
gcloud builds submit \
  --tag asia-northeast1-docker.pkg.dev/ringed-trail-472801-j4/backend-repo/backend:latest .

1.4 Cloud Run ã«ãƒ‡ãƒ—ãƒ­ã‚¤
gcloud run deploy backend \
  --image asia-northeast1-docker.pkg.dev/ringed-trail-472801-j4/backend-repo/backend:latest \
  --platform managed \
  --region asia-northeast1 \
  --allow-unauthenticated


ğŸ‘‰ ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸå¾Œã€URL ãŒç™ºè¡Œã•ã‚Œã‚‹
ä¾‹:

https://backend-xxxx-asia-northeast1.run.app

1.5 å‹•ä½œç¢ºèª
curl https://backend-xxxx-asia-northeast1.run.app/api/hello


æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š

{"message":"Hello from Flask API!"}

2. Firebase (Frontend: React â†’ Hosting)
2.1 Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

Firebase Console â†’ æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ä¾‹: pjk-frontend

Google Analytics ã¯ä»»æ„

2.2 Firebase CLI è¨­å®š
npm install -g firebase-tools
firebase login
firebase projects:list
firebase use <PROJECT_ID>

2.3 Hosting ã‚µã‚¤ãƒˆã‚’ä½œæˆ

ã‚·ãƒ³ãƒ—ãƒ«ãªåå‰ã¯äºˆç´„ã•ã‚Œã¦ã„ã‚‹ã®ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«ï¼š

firebase hosting:sites:create pjk-applicant
firebase hosting:sites:create pjk-admin

2.4 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å‰²ã‚Šå½“ã¦
firebase target:clear hosting applicant
firebase target:apply hosting applicant pjk-applicant
firebase target:apply hosting admin pjk-admin

2.5 firebase.json è¨­å®š

ãƒ«ãƒ¼ãƒˆã«é…ç½®ï¼š

{
  "hosting": [
    {
      "target": "applicant",
      "public": "frontend/applicant/build",
      "ignore": ["firebase.json", "**/.*", "**/node_modules/**"]
    },
    {
      "target": "admin",
      "public": "frontend/admin/build",
      "ignore": ["firebase.json", "**/.*", "**/node_modules/**"]
    }
  ]
}

2.6 React ã‚’ãƒ“ãƒ«ãƒ‰
cd frontend/applicant
npm run build

cd ../admin
npm run build

2.7 ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only hosting:applicant
firebase deploy --only hosting:admin


ğŸ‘‰ ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸå¾Œã® URL

applicant â†’ https://pjk-applicant.web.app

admin â†’ https://pjk-admin.web.app

3. Backend ã¨ Frontend ã®æ¥ç¶š
3.1 ç’°å¢ƒå¤‰æ•°è¨­å®š

frontend/applicant/.env.production
frontend/admin/.env.production

REACT_APP_API_URL=https://backend-xxxx-asia-northeast1.run.app

3.2 ç¢ºèª

æœ¬ç•ªã® applicant/admin ã‚µã‚¤ãƒˆã§

Backend says: Hello from Flask API!


ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°æ¥ç¶šå®Œäº† âœ…

4. é‹ç”¨ä¸Šã®æ³¨æ„

.env.production ã¯ Git ç®¡ç†ã—ãªã„ã“ã¨ï¼ˆ.env.example ã‚’å…±æœ‰ï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãŸã³ã« React ã‚’å†ãƒ“ãƒ«ãƒ‰ (npm run build) ã™ã‚‹å¿…è¦ã‚ã‚Š

ä¸è¦ã«ãªã£ãŸ Cloud Run ã‚µãƒ¼ãƒ“ã‚¹ã‚„ Artifact Registry ã®ãƒªãƒã‚¸ãƒˆãƒªã¯å‰Šé™¤ã—ã¦æ•´ç†å¯èƒ½

âœ… ã‚´ãƒ¼ãƒ«

Backend (Cloud Run) ã¨ Frontend (Firebase Hosting) ãŒæ¥ç¶šæ¸ˆã¿

applicant/admin ãã‚Œãã‚ŒãŒç‹¬è‡ª URL ã§å…¬é–‹

æœ¬ç•ªç’°å¢ƒã§åˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹